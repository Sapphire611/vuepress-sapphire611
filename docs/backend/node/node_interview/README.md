---
title: Node.js Backend Developer
date: 2023-9-1
categories:
  - Backend
tags:
  - node
  - interview
sidebar: "auto"
keys:
 - 6e0dc2521bd023fa6d124a78c1317ab9
publish: true
---

## StoreHub

### 3-minutes self-introduction in English

### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿä½¿ç”¨å¾®æœåŠ¡çš„ä¼˜åŠ¿/ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ

> å¾®æœåŠ¡æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå®ƒå°†ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‹†åˆ†æˆè®¸å¤šç‹¬ç«‹çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸”ä¸å…¶ä»–æœåŠ¡é€šä¿¡ã€‚è¿™ç§æ¶æ„é£æ ¼çš„ç›®çš„æ˜¯è®©åº”ç”¨ç¨‹åºæ›´å®¹æ˜“å¼€å‘ã€éƒ¨ç½²ã€ç»´æŠ¤å’Œæ‰©å±•ã€‚

- ä½¿ç”¨å¾®æœåŠ¡çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š
    - æ›´å®¹æ˜“å¼€å‘å’Œç»´æŠ¤ï¼šå°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºè®¸å¤šå°å‹æœåŠ¡å¯ä»¥è®©å¼€å‘äººå‘˜æ›´å®¹æ˜“åœ°ç†è§£å’Œä¿®æ”¹ä»£ç ã€‚
    - æ›´å®¹æ˜“éƒ¨ç½²ï¼šå› ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€‚è¿™ä½¿å¾—å¯ä»¥æ›´å¿«åœ°æ›´æ–°åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾è¿›è¡Œ A/B æµ‹è¯•ã€‚
    - æ›´å®¹æ˜“æ‰©å±•ï¼šå¾®æœåŠ¡æ¶æ„ä½¿å¾—å¯ä»¥æ›´è½»æ¾åœ°æ‰©å±•åº”ç”¨ç¨‹åºçš„æŸäº›éƒ¨åˆ†ï¼Œè€Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚
    - æ›´å®¹æ˜“å¤„ç†ä¸åŒæŠ€æœ¯æ ˆï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¯ä¸ªæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€ã€æ¡†æ¶å’Œæ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚

### SQL

#### Mysql & MongoDB & Redis ä»‹ç»ï¼Œåˆ†åˆ«åœ¨å“ªäº›åœºæ™¯ä¸‹å‘æŒ¥ä¼˜åŠ¿ï¼Ÿ
> MySQLã€MongoDB å’Œ Redis éƒ½æ˜¯å¸¸ç”¨çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒä»¬åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸‹å‘æŒ¥ä¼˜åŠ¿ã€‚

- MySQL æ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰é«˜åº¦å¯ç§»æ¤æ€§ã€ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚å®ƒåœ¨å¤„ç†å¤æ‚çš„å…³ç³»å‹æ•°æ®æ—¶è¡¨ç°ä¼˜è¶Šï¼Œä¾‹å¦‚åœ¨è®¢å•ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ç­‰åº”ç”¨ä¸­ã€‚

- MongoDB æ˜¯ä¸€ç§æ–‡æ¡£å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒæä¾›äº†é«˜æ€§èƒ½ã€é«˜å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚å®ƒèƒ½å¤Ÿè½»æ¾å¤„ç†å¤§é‡éç»“æ„åŒ–æ•°æ®ï¼Œä¾‹å¦‚åœ¨æ—¥å¿—ç®¡ç†ã€ç”¨æˆ·è¡Œä¸ºåˆ†æç­‰åº”ç”¨ä¸­ã€‚

- Redis æ˜¯ä¸€ç§å†…å­˜å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¿«é€Ÿè¯»å†™ï¼Œå…·æœ‰é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚å®ƒé€‚ç”¨äºç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå…¶ä»–å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ï¼Œä¾‹å¦‚åœ¨å®æ—¶æ¨èã€æ¸¸æˆçŠ¶æ€ç®¡ç†ç­‰åº”ç”¨ä¸­ã€‚

### æŸ¥æ‰¾4æœˆä»½çš„æ—¥å¿—ï¼ŒåŸºäºnameå»é‡

```sql 
Log
id, name, actions, createdTime, modifiedTime
```
#### mongodb: 

```js
db.logs.aggregate([
  {
    $match:{
      createdTime:{
         "$gte": ISODate("2023-04-01T00:00:00.000Z"), // è¿™é‡Œå–å†³äºæ—¶é—´æˆ³çš„æ ¼å¼ ISO/unix
         "$lt": ISODate("2023-05-01T00:00:00.000Z")
      }
    }
  },
  {
    $group: {
      _id: '$name', // åŸºäºnameå­—æ®µå»é‡
      original: {
        $first: '$$ROOT', // åœ¨originalä¸­ä¿ç•™$groupç¬¬ä¸€ä¸ªç»“æœï¼Œç”¨äºæ˜¾ç¤ºã€‚
        // ï¼ˆ$pushä¼šä¿ç•™é‡å¤çš„ç»“æœï¼‰
      },
    },
  },
  {
    $replaceRoot: {
      newRoot: '$original', // è®©originalå˜æˆæ ¹èŠ‚ç‚¹
    },
  },
]);
```

#### mysql: 

``` sql
SELECT name,action,createdTime,modifiedTime 
FROM Log 
WHERE createdTime BETWEEN '2022-04-01' and '2022-04-30' 
GROUP BY name,action,createdTime,modifiedTime;
```

### mongodbä¸­ç´¢å¼•æœ‰å“ªäº›ç±»å‹ï¼Ÿåˆ†åˆ«æ€ä¹ˆä½¿ç”¨ï¼Ÿ

 | ç±»å‹             | è¯´æ˜         | ä½œç”¨                                                |
 | ---------------- | ------------ | --------------------------------------------------- |
 | Single Filed     | å•å­—æ®µç´¢å¼•   | åœ¨æ™®é€šå­—æ®µã€å­æ–‡æŒ¡ä»¥åŠå­æ–‡æ¡£çš„æŸä¸ª å­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼• |
 | Compound Index   | å¤åˆç´¢å¼•     | åŒæ—¶åœ¨å¤šä¸ªå­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼•                          |
 | Multikey Index   | å¤šé”®ç´¢å¼•     | å¯¹æ•°ç»„å»ºç«‹çš„ç´¢å¼•                                    |
 | Geospatial Index | åœ°ç†ç©ºé—´ç´¢å¼• | å¯¹åœ°ç†ä½ç½®å‹æ•°æ®å»ºç«‹çš„ç´¢å¼•ï¼ˆæ”¯æŒçƒé¢å’Œå¹³é¢ï¼‰        |
 | Textlndex        | å…¨æ–‡ç´¢å¼•     | å¯¹æ¯ä¸€ä¸ªè¯å»ºç«‹ç´¢å¼•ï¼Œæ”¯æŒå…¨æ–‡æœç´¢                    |
 | Hashed Index     | å“ˆå¸Œç´¢å¼•     | ç´¢å¼•ä¸­å­˜å‚¨çš„æ˜¯è¢«ç´¢å¼•é”®çš„å“ˆå¸Œå€¼                      |

### æŠŠ callback æ”¹å†™æˆ Promise 

```js
function test(arg, callback) {
    // â€¦ 
    if (err) {
        callback(err);
    } else {
        callback(null, arg);
    }
}

function testAsync(arg) {
    //â€¦ Write here
}

const main = async function () {
    try {
        const a = await testAsync(arg);
    } catch (error) {
        console.error(error);
    }
}
main()
```
---

```js
/**
 *  @Author     :   ruanchuhao
 *  @Date       :   2022/11/30
 *  @Name       :   test.js
 *  @Content    :   ruanchuhao@shgbit.com
 *  @Desc       :
 */

'use strict';

// ### æŠŠ callback æ”¹å†™æˆ Promise

function test(arg, callback) {
    const err = undefined;
    // â€¦
    if (err) {
        callback(err);
    } else {
        callback(null, arg);
    }
}

function testAsync(arg) {
    return new Promise((resolve, reject) => {
        test(arg, (err, arg) => {
            if (err) {
                reject(err);
            } else {
                resolve(arg);
            }
        });
    });
}

const main = async function () {
    try {
        const arg = {};
        const a = await testAsync(arg);
        console.log(a)
    } catch (error) {
        console.error(error);
    }
}

main()
```
### ç®—æ³•é¢˜ï¼šæ‹¬å·åŒ¹é… leetcode 20 

[ç®—æ³•é¢˜ï¼šæ‹¬å·åŒ¹é… leetcode 20](/backend/node/leetcode-js/#_20-æœ‰æ•ˆçš„æ‹¬å·)

[ç®—æ³•é¢˜ï¼šæœç´¢æ—‹è½¬æ’åºæ•°ç»„ leetcode 33](/backend/nodeÃŸ/leetcode-js/#_33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„)

## NGA

### ä»€ä¹ˆæ˜¯ æ§åˆ¶åè½¬ && ä¾èµ–æ³¨å…¥ï¼Ÿ

ä¾èµ–æ³¨å…¥ (Dependency Injection) å’Œæ§åˆ¶åè½¬ (Inversion of Control, IoC) æ˜¯ç›¸å…³çš„è®¾è®¡æ¨¡å¼ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚

æ§åˆ¶åè½¬æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒç”±ä¸€ä¸ªä¸­å¤®æ§åˆ¶å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªIoCå®¹å™¨ï¼‰æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè€Œä¸æ˜¯ç”±å¯¹è±¡è‡ªå·±æ¥ç®¡ç†è¿™äº›å…³ç³»ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ æ¾è€¦åˆï¼Œå¹¶ä½¿å¾—ç³»ç»Ÿæ›´æ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚

ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨è¿è¡Œæ—¶è·å¾—æ‰€éœ€çš„ä¾èµ–å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥æ›´åŠ çµæ´»åœ°ç®¡ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä½¿å¾—ä»£ç æ›´æ˜“äºæµ‹è¯•å’Œç»´æŠ¤ã€‚

```js
class Engine { }

class Car {
  constructor(engine) {
    this.engine = engine;
  }
}

const engine = new Engine();
const car = new Car(engine);
```

> æ‰€ä»¥å¯ä»¥è¯´ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§å…·ä½“çš„å®ç°æ–¹å¼ï¼Œè€Œæ§åˆ¶åè½¬æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ§åˆ¶åè½¬è¢«ç”¨æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚

> å®ç°æ–¹å¼ï¼šæ„é€ å‡½æ•°æ³¨å…¥ï¼Œå±æ€§æ³¨å…¥ï¼Œsetteræ³¨å…¥
```js
class Engine { }

class Car {
  constructor() {
    this.engine = null;
  }
}

const container = new Map(); // IOCå®¹å™¨æ³¨å…¥
container.set("Engine", Engine);
container.set("Car", Car);

const car = container.get("Car");
car.engine = container.get("Engine");
```
### å¤šå®ä¾‹æƒ…å†µä¸‹ï¼Œæ€ä¹ˆé€šè¿‡redisé˜²æ­¢å®šæ—¶ä»»åŠ¡å¤šæ¬¡æ‰§è¡Œï¼Ÿ

> åœ¨å¤šå®ä¾‹æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”æ¥é˜²æ­¢å®šæ—¶ä»»åŠ¡å¤šæ¬¡æ‰§è¡Œã€‚

1.åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡ä¹‹å‰ï¼Œä½¿ç”¨ Redis çš„ SETNX å‘½ä»¤å°è¯•è·å–é”ã€‚å¦‚æœè·å–æˆåŠŸï¼Œè¯´æ˜è¯¥å®ä¾‹è·å¾—äº†é”ï¼Œå¯ä»¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚

2.åœ¨æ‰§è¡Œå®Œå®šæ—¶ä»»åŠ¡ä¹‹åï¼Œä½¿ç”¨ Redis çš„ DEL å‘½ä»¤é‡Šæ”¾é”ã€‚

3.å¦‚æœè·å–é”å¤±è´¥ï¼Œè¯´æ˜å…¶ä»–å®ä¾‹å·²ç»è·å¾—äº†é”ï¼Œè¯¥å®ä¾‹åº”è¯¥ç­‰å¾…å…¶ä»–å®ä¾‹é‡Šæ”¾é”ã€‚

ä»£ç ç¤ºä¾‹ï¼š

```js
const Redis = require("ioredis");
const redis = new Redis();

const taskName = "myTask";
const lockTTL = 60; // lock expires in 60 seconds

async function runTask() {
  // try to acquire lock
  const lockAcquired = await redis.setnx(taskName, 1);
  if (!lockAcquired) {
    console.log("Task already running, exiting...");
    return;
  }
  
  // set lock expiration
  await redis.expire(taskName, lockTTL);
  
  try {
    // perform task
    console.log("Running task...");
    // ...
  } finally {
    // release lock
    await redis.del(taskName);
  }
}
```

> è¿™æ ·å¯ä»¥ç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªå®ä¾‹åœ¨æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œé¿å…äº†å¤šæ¬¡æ‰§è¡Œçš„é—®é¢˜ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨ Redis åˆ†å¸ƒå¼é”æ—¶ï¼Œè¦å°½é‡é¿å…æ­»é”çš„æƒ…å†µï¼Œå¦‚æœé”è¢«å ç”¨è¿‡é•¿å¯ä»¥åœ¨è¶…æ—¶æ—¶é—´åè‡ªåŠ¨é‡Šæ”¾é”æˆ–è€…äººå·¥é‡Šæ”¾ã€‚

---

## ShuRui

### 1. Node å’Œ Ajax æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> Node.js å’Œ Ajax æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚

- Node.js æ˜¯ä¸€ä¸ªåŸºäº JavaScript çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç”¨äºåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—çš„å†…ç½®æ¨¡å—å’Œæ‰©å±•åº“ï¼Œç”¨äºç®€åŒ–æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚

- Ajax æ˜¯ä¸€ç§åŸºäº JavaScript å’Œ XMLï¼ˆæˆ– JSONï¼‰çš„æŠ€æœ¯ï¼Œç”¨äºå®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„å¼‚æ­¥é€šä¿¡ã€‚Ajax å¯ä»¥åœ¨ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹æ›´æ–°éƒ¨åˆ†é¡µé¢å†…å®¹ï¼Œä»è€Œæé«˜äº†ç½‘ç«™çš„å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚Ajax ä¸»è¦æ˜¯åœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„æŠ€æœ¯ï¼Œé€šè¿‡æµè§ˆå™¨å†…ç½®çš„ **XMLHttpRequest** å¯¹è±¡æ¥å®ç°ä¸æœåŠ¡å™¨ç«¯çš„å¼‚æ­¥é€šä¿¡ã€‚

> å› æ­¤ï¼ŒNode.js å’Œ Ajax æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚Node.js ä¸»è¦æ˜¯ç”¨äºåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè€Œ Ajax ä¸»è¦æ˜¯ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚

### 2. Node Stream æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›ç§ç±»çš„Streamï¼Ÿ

> åœ¨Node.jsä¸­ï¼ŒStreamæ˜¯ä¸€ç§ç”¨äº**å¤„ç†æµæ•°æ®çš„æŠ½è±¡æ¥å£**ã€‚å®ƒæä¾›äº†ä¸€ç§å¤„ç†å¤§é‡æ•°æ®çš„æ–¹å¼ï¼Œä»¥åŠå¯¹æ•°æ®è¿›è¡Œæµå¼ä¼ è¾“å’Œå¤„ç†çš„èƒ½åŠ›ã€‚Streamå¯ä»¥é€šè¿‡**è¯»å–ã€å†™å…¥ã€è½¬æ¢ã€è¿‡æ»¤**ç­‰æ–¹å¼æ¥å¤„ç†æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®åˆ°å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—å¤„ç†å¤§æ–‡ä»¶æˆ–å¤§é‡æ•°æ®å˜å¾—æ›´åŠ é«˜æ•ˆå’Œå¯è¡Œã€‚Node.jsä¸­çš„Streamæœ‰å››ç§ç±»å‹ï¼š

1. Readable Streamï¼šç”¨äºè¯»å–æ•°æ®çš„Streamï¼Œä¾‹å¦‚ä»æ–‡ä»¶ã€ç½‘ç»œç­‰æºè¯»å–æ•°æ®ã€‚

2. Writable Streamï¼šç”¨äºå†™å…¥æ•°æ®çš„Streamï¼Œä¾‹å¦‚å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€å‘é€æ•°æ®åˆ°ç½‘ç»œç­‰ã€‚

3. Duplex Streamï¼šå¯åŒæ—¶è¯»å–å’Œå†™å…¥æ•°æ®çš„Streamï¼Œä¾‹å¦‚ç½‘ç»œå¥—æ¥å­—ç­‰ã€‚

4. Transform Streamï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„Duplex Streamï¼Œç”¨äºå¤„ç†å’Œè½¬æ¢æ•°æ®æµã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨Transform Streamå°†æ–‡ä»¶å†…å®¹è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†ï¼Œæˆ–å°†CSVæ•°æ®è½¬æ¢ä¸ºJSONæ ¼å¼ã€‚

### 3. fs.readFile() å’Œ fs.createReadStream() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

| åŒºåˆ«     | fs.readFile()          | fs.createReadStream()                    |
| -------- | ---------------------- | ---------------------------------------- |
| è¯»å–åˆ°   | å…¨éƒ¨è¯»å–åˆ°å†…å­˜         | åˆ†æˆä¸€ç³»åˆ—å°å—ï¼ˆç¼“å†²åŒºï¼‰ï¼Œé€å—è¯»å–å’Œå¤„ç† |
| é€‚ç”¨äº   | è¾ƒå°çš„æ–‡ä»¶æˆ–æ•°æ®       | å¤§å‹æ–‡ä»¶æˆ–æ•°æ®é›†                         |
| callback | ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°è¿”å› | é€šè¿‡ç›‘å¬å®Œæˆè¯»å–æ“ä½œ                     |

---

# MiaoDian 

### 1. node è¯­è¨€çš„åŠ£åŠ¿

1. å•çº¿ç¨‹ï¼šNode.jsé‡‡ç”¨**å•çº¿ç¨‹**çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œè¿™æ„å‘³ç€å®ƒåªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚æˆ–äº‹ä»¶çš„åŒæ—¶ã€‚è¿™åœ¨å¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡æˆ–é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œæ—¶å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜

::: warning
å°½ç®¡Node.jsé€šè¿‡å¼‚æ­¥éé˜»å¡çš„æ–¹å¼æ¥å¤„ç†I/Oæ“ä½œï¼Œä½†å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œä¼šé˜»å¡æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰§è¡Œã€‚
::: 

2. å†…å­˜å ç”¨ï¼šNode.jsåœ¨å¤„ç†å¤§è§„æ¨¡å¹¶å‘è¯·æ±‚æ—¶å¯èƒ½ä¼š**å ç”¨è¾ƒå¤šçš„å†…å­˜**ã€‚æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸€å®šçš„å†…å­˜åˆ†é…ï¼Œå› æ­¤å½“åŒæ—¶å¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼ŒNode.jsåº”ç”¨ç¨‹åºçš„å†…å­˜æ¶ˆè€—ä¼šå¢åŠ ã€‚è¿™å¯¹äºå†…å­˜æœ‰é™çš„æœåŠ¡å™¨æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

::: tip
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡Node.jsæœ‰è¿™äº›åŠ£åŠ¿ï¼Œå®ƒåœ¨å¤„ç†**é«˜å¹¶å‘**ã€**I/Oå¯†é›†å‹ä»»åŠ¡**å’Œ**æ„å»ºå®æ—¶åº”ç”¨**ç­‰æ–¹é¢ä»ç„¶è¡¨ç°å‡ºè‰²ã€‚é€‰æ‹©ä½¿ç”¨Node.jsè¿˜æ˜¯å…¶ä»–åç«¯è¯­è¨€ï¼Œå–å†³äºå…·ä½“çš„åº”ç”¨éœ€æ±‚å’Œå›¢é˜Ÿçš„æŠ€æœ¯æ ˆã€‚
:::

### 2. mongodbçš„åŠ£åŠ¿

1. é«˜å­˜å‚¨ç©ºé—´éœ€æ±‚ï¼šç›¸æ¯”äºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼ŒMongoDBåœ¨å­˜å‚¨æ•°æ®æ—¶é€šå¸¸**éœ€è¦æ›´å¤šçš„ç£ç›˜ç©ºé—´**ã€‚

> è¿™æ˜¯å› ä¸ºMongoDBä½¿ç”¨äº†ä¸€äº›é¢å¤–çš„æ•°æ®ç»“æ„å’Œç´¢å¼•æ¥æä¾›é«˜æ•ˆçš„æŸ¥è¯¢å’Œçµæ´»çš„æ•°æ®æ¨¡å‹ã€‚

2. ç¼ºä¹äº‹åŠ¡æ”¯æŒï¼šMongoDBåœ¨æ—©æœŸç‰ˆæœ¬ä¸­ç¼ºä¹åŸç”Ÿçš„å¤šæ–‡æ¡£äº‹åŠ¡æ”¯æŒï¼Œå°½ç®¡åœ¨åç»­ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€äº›äº‹åŠ¡åŠŸèƒ½ï¼Œä½†ç›¸å¯¹äºä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒçš„äº‹åŠ¡æ”¯æŒè¿˜ä¸å¤Ÿæˆç†Ÿå’Œå¼ºå¤§ã€‚è¿™å¯èƒ½å¯¹æŸäº›éœ€è¦ä¸¥æ ¼äº‹åŠ¡å¤„ç†çš„åº”ç”¨åœºæ™¯é€ æˆé™åˆ¶ã€‚

::: tip
Mongodb 4.0 ä¹‹åæ”¯æŒäº‹åŠ¡
:::

3. ä¸é€‚åˆå¤æ‚çš„å…³ç³»å‹æŸ¥è¯¢ï¼šMongoDBæ˜¯ä¸€ç§æ–‡æ¡£æ•°æ®åº“ï¼Œå…¶è®¾è®¡ç›®æ ‡ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒçµæ´»çš„æ•°æ®æ¨¡å‹å’Œå¤§è§„æ¨¡çš„æ°´å¹³æ‰©å±•ã€‚ç„¶è€Œï¼Œå¯¹äºéœ€è¦æ‰§è¡Œå¤æ‚çš„å…³ç³»å‹æŸ¥è¯¢ï¼ˆä¾‹å¦‚å¤šè¡¨è¿æ¥ã€èšåˆç­‰ï¼‰çš„åº”ç”¨ï¼ŒMongoDBçš„æŸ¥è¯¢èƒ½åŠ›ç›¸å¯¹è¾ƒå¼±ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å¯èƒ½æ›´é€‚åˆã€‚

4. è¾ƒå°çš„ç¤¾åŒºå’Œç”Ÿæ€ç³»ç»Ÿï¼šç›¸å¯¹äºä¸€äº›ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼ŒMongoDBçš„ç¤¾åŒºå’Œç”Ÿæ€ç³»ç»Ÿç›¸å¯¹è¾ƒå°ã€‚è¿™å¯èƒ½æ„å‘³ç€åœ¨è§£å†³é—®é¢˜ã€æ‰¾åˆ°æ”¯æŒå’Œå¯»æ‰¾ç¬¬ä¸‰æ–¹å·¥å…·æ—¶ï¼Œå¯èƒ½éœ€è¦ä»˜å‡ºæ›´å¤šçš„åŠªåŠ›ã€‚

### 3. Mysql æŸ¥è¯¢å­¦ç”Ÿä¸‰é—¨ç§‘ç›®æ€»åˆ†æœ€é«˜çš„ å‰ä¸‰å

1. å­¦ç”Ÿå’Œæˆç»©åˆ†è¡¨
  
```sql
CREATE TABLE students (
  id INT PRIMARY KEY,
  name VARCHAR(50)
);

CREATE TABLE scores (
  student_id INT,
  subject VARCHAR(50),
  score INT
);
```

```sql
select name,sum(score) as total
from students
join scores on scores.student_id = students.id
GROUP BY name
ORDER BY total desc
limit 3
```

---

2. å­¦ç”Ÿå’Œæˆç»©åˆè¡¨

```sql
CREATE TABLE students (
  id INT PRIMARY KEY,
  name VARCHAR(50),
  subject1_score INT,
  subject2_score INT,
  subject3_score INT
);
```

```sql
select name,(subject1_score + subject2_score + subject3_score) as total
from student
ORDER BY total desc
limit 3
```

# å¿ƒæ‚¦äº’å¨±

### 1. å¦‚ä½•ä½¿ç”¨nodejsè¯»å–ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼Ÿ


> **fs.readFile** æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå½“æ–‡ä»¶è¯»å–å®Œæˆæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚è¿™ç§æ–¹å¼é€‚åˆåœ¨éé˜»å¡çš„æƒ…å†µä¸‹æ‰§è¡Œæ–‡ä»¶è¯»å–æ“ä½œï¼Œä¸ä¼šé˜»æ­¢åç»­ä»£ç çš„æ‰§è¡Œã€‚

> **fs.readFileSync** æ˜¯ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ–‡ä»¶è¯»å–å®Œæˆã€‚è¿™æ„å‘³ç€åœ¨æ–‡ä»¶è¯»å–å®Œæˆä¹‹å‰ï¼Œç¨‹åºæ— æ³•æ‰§è¡Œå…¶ä»–æ“ä½œã€‚å› æ­¤ï¼Œé€šå¸¸ä¸å»ºè®®åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨åŒæ­¥æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨æœåŠ¡å™¨ç«¯åº”ç”¨ä¸­ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜å’Œé˜»å¡ã€‚

> **fs.promises.readFile** æ˜¯ä¸€ä¸ªå¼‚æ­¥ Promise æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå…è®¸æ‚¨ä½¿ç”¨ async/await æˆ– Promise é“¾å¼è°ƒç”¨æ¥å¤„ç†æ–‡ä»¶è¯»å–æ“ä½œã€‚è¿™ç§æ–¹å¼åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­æ›´åŠ æ–¹ä¾¿å’Œå¯è¯»ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚

### 3. å¦‚ä½•åšåˆ°åˆ›å»ºnodejsé›†ç¾¤å¹¶åšåˆ°ä¸ä¸­æ–­é‡å¯ï¼Ÿ

```js
const cluster = require('cluster');
const http = require('http');
const numCPUs = require('os').cpus().length;

if (cluster.isMaster) {
    console.log(`ä¸»è¿›ç¨‹ ${process.pid} æ­£åœ¨è¿è¡Œ`);

    // åˆ›å»ºå­è¿›ç¨‹
    for (let i = 0; i < numCPUs; i++) {
        cluster.fork();
    }

    // ç›‘å¬å­è¿›ç¨‹é€€å‡ºäº‹ä»¶
    cluster.on('exit', (worker, code, signal) => {
        console.log(`å­è¿›ç¨‹ ${worker.process.pid} åœæ­¢è¿è¡Œ`);
        // é‡å¯å­è¿›ç¨‹
        cluster.fork();
    });
} else {
    // åœ¨å­è¿›ç¨‹ä¸­åˆ›å»º HTTP æœåŠ¡å™¨
    http.createServer((req, res) => {
        res.writeHead(200);
        res.end('Hello, World!');
    }).listen(8000);

    console.log(`å­è¿›ç¨‹ ${process.pid} æ­£åœ¨è¿è¡Œ`);
}
```

### 4. nodejsé›†ç¾¤çš„ä¼˜åŠ¿å’Œé™åˆ¶

#### ä¼˜åŠ¿

1. é«˜å¯æ‰©å±•æ€§ï¼šNode.jsé›†ç¾¤å…è®¸åœ¨å¤šä¸ªè¿›ç¨‹ä¸­å¹¶è¡Œå¤„ç†è¯·æ±‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“å¤„ç†èƒ½åŠ›å’Œååé‡ã€‚æ¯ä¸ªå­è¿›ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°å¤„ç†è¯·æ±‚ï¼Œè€Œä¸ä¼šé˜»å¡å…¶ä»–è¿›ç¨‹ã€‚

2. é«˜å¯ç”¨æ€§ï¼šå½“ä¸€ä¸ªå­è¿›ç¨‹å´©æºƒæˆ–å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸»è¿›ç¨‹å¯ä»¥æ£€æµ‹åˆ°å¹¶é‡æ–°å¯åŠ¨æ–°çš„å­è¿›ç¨‹ï¼Œä»è€Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚è¿™ç§æœºåˆ¶å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘å› ä¸ºå•ä¸ªè¿›ç¨‹æ•…éšœå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒçš„é£é™©ã€‚
  
3. è´Ÿè½½å‡è¡¡ï¼šNode.jsé›†ç¾¤å¯ä»¥é€šè¿‡å°†è¯·æ±‚åˆ†å‘ç»™ä¸åŒçš„å­è¿›ç¨‹æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œç¡®ä¿è¯·æ±‚åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚è¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

4. å¤šæ ¸åˆ©ç”¨ï¼šNode.jsé›†ç¾¤å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿ï¼Œæ¯ä¸ªå­è¿›ç¨‹å¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„CPUæ ¸å¿ƒä¸Šï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚

#### é™åˆ¶

1. å…±äº«çŠ¶æ€ç®¡ç†ï¼šNode.jsé›†ç¾¤ä¸­çš„å­è¿›ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¹‹é—´æ— æ³•ç›´æ¥å…±äº«å†…å­˜æˆ–çŠ¶æ€ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¾èµ–äºå…±äº«çŠ¶æ€ç®¡ç†ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„æœºåˆ¶æ¥å®ç°çŠ¶æ€å…±äº«ï¼Œä¾‹å¦‚ä½¿ç”¨å…±äº«æ•°æ®åº“æˆ–æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚

2. å†…å­˜æ¶ˆè€—ï¼šæ¯ä¸ªå­è¿›ç¨‹éƒ½ä¼šå ç”¨ä¸€å®šçš„å†…å­˜èµ„æºï¼Œå› æ­¤åœ¨åˆ›å»ºå¤šä¸ªå­è¿›ç¨‹æ—¶éœ€è¦è€ƒè™‘å†…å­˜æ¶ˆè€—çš„å¢åŠ ã€‚å¦‚æœæœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œè¿‡å¤šçš„å­è¿›ç¨‹å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ä¸è¶³æˆ–äº¤æ¢å†…å­˜é¢‘ç¹ï¼Œå½±å“æ€§èƒ½ã€‚

3. è¿›ç¨‹é—´é€šä¿¡ï¼šåœ¨Node.jsé›†ç¾¤ä¸­ï¼Œå­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡éœ€è¦é€šè¿‡è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶æ¥å®ç°ï¼Œä¾‹å¦‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æˆ–å…±äº«å†…å­˜ã€‚è¿™å¯èƒ½å¢åŠ ä¸€äº›å¼€å‘å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚

4. ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼šåœ¨å¤šä¸ªå­è¿›ç¨‹ä¹‹é—´åˆ‡æ¢ä¸Šä¸‹æ–‡ä¼šå¸¦æ¥ä¸€äº›å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨å¤§é‡çš„è¯·æ±‚å¹¶å‘æ—¶ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œé…ç½®Node.jsé›†ç¾¤æ—¶éœ€è¦å¹³è¡¡å¹¶å‘èƒ½åŠ›å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚

> ç»¼ä¸Šæ‰€è¿°ï¼ŒNode.jsé›†ç¾¤åœ¨é«˜å¹¶å‘ã€é«˜å¯æ‰©å±•æ€§å’Œé«˜å¯é æ€§æ–¹é¢å…·æœ‰ä¼˜åŠ¿ï¼Œä½†åœ¨å…±äº«çŠ¶æ€ç®¡ç†ã€å†…å­˜æ¶ˆè€—å’Œè¿›ç¨‹é—´é€šä¿¡ç­‰æ–¹é¢å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘å’Œæƒè¡¡æ¥é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆã€‚

### 5. mongo æ‰£å‡åº“å­˜æ—¶å¦‚ä½•ä¿è¯åŸå­ä¸€è‡´æ€§ï¼Ÿ

> è¿™é‡Œä½¿ç”¨mongooseçš„ç‰ˆæœ¬

```js
const session = await mongoose.startSession();
session.startTransaction();

try {
  // åœ¨ session ä¸­æ‰§è¡Œæ“ä½œ
  await InventoryModel.updateOne(
    { _id: productId, quantity: { $gte: quantity } },
    { $inc: { quantity: -quantity } },
    { session }
  );

  await RecordModel.create(
    {
      productId: productId,
      quantity: -quantity,
      timestamp: new Date()
    },
    { session }
  );

  await session.commitTransaction();
  session.endSession();
} catch (error) {
  await session.abortTransaction();
  session.endSession();
  throw error;
}
```

### 6.è¯·å†™å‡ºç¬¦åˆä¸‹åˆ—è¦æ±‚çš„ mongodb æŸ¥è¯¢è¯­å¥:

> æŸ¥è¯¢è¡¨ user ä¸­ï¼Œname æ˜¯ abcï¼Œä¸” age å¤§äº 30 å²æˆ–å°äºç­‰äº 10 å²çš„æ•°æ®ï¼Œè·³è¿‡ 100 æ¡æ•°æ®ä¹‹åçš„ 50 æ¡æ•°æ®ï¼ŒæŒ‰å¹´é¾„é€†åºæ’åˆ—ï¼Œå¹¶ä»…è¿”å› name å’Œ age ä¸¤ä¸ªå­—æ®µ

```js
const query = await User.find({
  name: 'abc',
  $or: [
    { age: { $gt: 30 } },
    { age: { $lte: 10 } }
  ]
})
  .skip(100)
  .limit(50)
  .sort({ age: -1 })
  .select('name age');
```
```js
const oprs = [
  {
    $match: {
      name: 'abc',
      $or: [
        { age: { $gt: 30 } },
        { age: { $lte: 10 } }
      ]
    }
  },
  { $sort: { age: -1 } },
  { $skip: 100 },
  { $limit: 50 },
  { $project: { name: 1, age: 1 } }
];

await User.aggregate(oprs);
```

### 7. å¦‚ä½•ä½¿ç”¨rediså®ç°ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ

> è¦ä½¿ç”¨ Redis å®ç°ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½ å¯ä»¥å€ŸåŠ© Redis çš„åˆ—è¡¨æ•°æ®ç»“æ„æ¥å®ç°ã€‚

> ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Redis æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š


```js
const Redis = require('ioredis');
const client = new Redis(6379, "127.0.0.1");

async function send(msg){
    const cur = await client.llen('test_queue');
    console.log(cur); // è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—ä¸Šé™ä¸º5

    if(cur > 5){
        console.error('size more than 5');
        return;
    }
    await client.lpush('test_queue',msg);
}

async function poll(){
    try{
        const message = await client.rpop('test_queue');
        if(message){
            console.debug(message);
        }
    } catch (err){
        console.error(err);
    }

    process.nextTick(poll);
}


poll();

async function main(){
    await send('111');
    await send('222');
    await send('333');
    await send('444');
    await send('555');
    await send('666');
}

main();



```

### 8.ç”¨ redis å®ç°ä¸€ä¸ªåˆ†æ•°æ’è¡Œæ¦œï¼Œå¹¶ä»ä¸­æŸ¥æ‰¾å‰ååçš„æ•°æ®

```bash
zadd leaderboard 100 PlayerA
zadd leaderboard 80 PlayerB
zadd leaderboard 120 PlayerC
zrevrange leaderboard 0 9 WITHSCORES
```

```js
const redis = require('ioredis');
const client = redis.createClient();

// æ·»åŠ æˆå‘˜å’Œåˆ†æ•°åˆ°æ’è¡Œæ¦œ
function addMemberToLeaderboard(member, score) {
    client.zadd('leaderboard', score, member, (err, reply) => {
        if (err) {
            console.error('Failed to add member to leaderboard:', err);
        } else {
            console.log('Member added to leaderboard:', member);
        }
    });
}

// è·å–æ’è¡Œæ¦œå‰ååçš„æ•°æ®
function getTopTenFromLeaderboard() {
    client.zrevrange('leaderboard', 0, 9, 'WITHSCORES', (err, results) => {
        if (err) {
            console.error('Failed to get top ten from leaderboard:', err);
        } else {
            console.debug(results);
            // [
            //     'PlayerL', '123',     'PlayerI',
            //     '122',     'PlayerF', '121',
            //     'PlayerC', '120',     'PlayerJ',
            //     '103',     'PlayerG', '102',
            //     'PlayerD', '101',     'PlayerA',
            //     '100',     'PlayerK', '83',
            //     'PlayerH', '82'
            //   ]
            console.log('Top ten from leaderboard:');
            for (let i = 0; i < results.length; i += 2) {
                const member = results[i];
                const score = results[i + 1];
                console.log(`${i / 2 + 1}. Member: ${member}, Score: ${score}`);
            }
        }
    });
}

// ç¤ºä¾‹æ·»åŠ æˆå‘˜å’Œåˆ†æ•°åˆ°æ’è¡Œæ¦œ
addMemberToLeaderboard('PlayerA', 100);
addMemberToLeaderboard('PlayerB', 80);
addMemberToLeaderboard('PlayerC', 120);

addMemberToLeaderboard('PlayerD', 101);
addMemberToLeaderboard('PlayerE', 81);
addMemberToLeaderboard('PlayerF', 121);

addMemberToLeaderboard('PlayerG', 102);
addMemberToLeaderboard('PlayerH', 82);
addMemberToLeaderboard('PlayerI', 122);

addMemberToLeaderboard('PlayerJ', 103);
addMemberToLeaderboard('PlayerK', 83);
addMemberToLeaderboard('PlayerL', 123);

// æŸ¥è¯¢æ’è¡Œæ¦œå‰ååçš„æ•°æ®
getTopTenFromLeaderboard();
```

### 9.å’Œä»–äººåœ¨åŒä¸€ä¸ª git åˆ†æ”¯å¼€å‘ï¼Œåœ¨æœ¬åœ°å¼€å‘å¥½ä¸€ä¸ªåŠŸèƒ½åï¼Œå¦‚ä½•æäº¤å¹¶ä¸Šä¼ æœåŠ¡å™¨å¯ä»¥å°½å¯èƒ½çš„å‡å°‘å†²çªå¹¶ä¿ç•™å®Œæ•´æäº¤å†å²ï¼Œåˆ—ä¸¾ä½¿ç”¨çš„å‘½ä»¤æˆ–æ“ä½œ

```bash
git stash # ä¿å­˜å½“å‰å·¥ä½œåŒº
git pull # æ‹‰å–è¿œç¨‹åˆ†æ”¯
git stash apply # æ¢å¤å·¥ä½œåŒº
git add . # æ·»åŠ ä¿®æ”¹
git commit -m 'xxx' # æäº¤ä¿®æ”¹
git push # æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
```

### 10.åˆ—ä¸¾ js ä¸­æ•°ç»„éå†ç›¸å…³çš„æ–¹æ³•




1. for å¾ªç¯
```javascript
const array = [1, 2, 3, 4, 5];
for (let i = 0; i < array.length; i++) {  
  console.log(array[i]);
}
```

2. for...of å¾ªç¯ï¼šç”¨äºéå†å¯è¿­ä»£å¯¹è±¡ï¼Œä¾‹å¦‚æ•°ç»„ã€å­—ç¬¦ä¸²ç­‰ã€‚
```javascript
const array = [1, 2, 3, 4, 5];
for (const item of array) {  console.log(item);}
```

3. forEach æ–¹æ³•ï¼š
   
```javascript 
const array = [1, 2, 3, 4, 5];
array.forEach(item => {  console.log(item);});
```

4. map æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å¯¹åŸå§‹æ•°ç»„æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†åçš„ç»“æœã€‚
```javascript
const array = [1, 2, 3, 4, 5];
const newArray1 = array.map(item => item * 2);
console.log(newArray);
```

5. filter æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„åŸå§‹æ•°ç»„å…ƒç´ ã€‚
```javascript
const array = [1, 2, 3, 4, 5];
const newArray2 = array.filter(item => item > 2);
console.log(newArray);
```

6. reduce æ–¹æ³•ï¼šé€šè¿‡å¯¹åŸå§‹æ•°ç»„çš„ç´¯ç§¯è®¡ç®—ï¼Œè¿”å›ä¸€ä¸ªå•ä¸€çš„å€¼ã€‚

> å›è°ƒå‡½æ•°ï¼ˆcallback functionï¼‰ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æ•°ç»„å…ƒç´ çš„å‡½æ•°ï¼Œå®ƒæ¥å—å››ä¸ªå‚æ•°ï¼šç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰ã€å½“å‰å€¼ï¼ˆcurrent valueï¼‰ã€å½“å‰ç´¢å¼•ï¼ˆcurrent indexï¼‰å’ŒåŸå§‹æ•°ç»„ï¼ˆarrayï¼‰ã€‚å›è°ƒå‡½æ•°åœ¨æ¯ä¸ªæ•°ç»„å…ƒç´ ä¸Šè¢«è°ƒç”¨ï¼Œå¯ä»¥æ‰§è¡Œä»»æ„æ“ä½œå¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å°†ä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£çš„ç´¯åŠ å™¨çš„å€¼

> åˆå§‹ç´¯åŠ å™¨çš„å€¼ï¼ˆinitial accumulator valueï¼‰ï¼šè¿™æ˜¯å¯é€‰çš„å‚æ•°ï¼ŒæŒ‡å®šåˆå§‹çš„ç´¯åŠ å™¨çš„å€¼ã€‚å¦‚æœæœªæä¾›è¯¥å‚æ•°ï¼Œåˆ™å°†ä½¿ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåˆå§‹ç´¯åŠ å™¨çš„å€¼ï¼Œå¹¶ä»æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹è¿­ä»£ã€‚

```javascript
const array = [1, 2, 3, 4, 5];
const sum = array.reduce((accumulator, currentValue) => accumulator + currentValue);
console.log(sum);
```




### 11.åˆ—ä¸¾å‡ ä¸ª es6 ä»¥åçš„æ–°ç‰¹æ€§

1. å—çº§ä½œç”¨åŸŸï¼ˆBlock Scopeï¼‰ï¼šé€šè¿‡ä½¿ç”¨ let å’Œ const å…³é”®å­—ï¼Œå¼•å…¥äº†å—çº§ä½œç”¨åŸŸï¼Œä½¿å¾—å˜é‡å’Œå¸¸é‡çš„ä½œç”¨åŸŸä»…é™äºå®šä¹‰å®ƒä»¬çš„å—å†…éƒ¨ã€‚

2. ç®­å¤´å‡½æ•°ï¼ˆArrow Functionsï¼‰ï¼šä½¿ç”¨ => è¯­æ³•å®šä¹‰å‡½æ•°ï¼Œå¯ä»¥æ›´ç®€æ´åœ°ç¼–å†™å‡½æ•°è¡¨è¾¾å¼ï¼Œå¹¶è‡ªåŠ¨ç»‘å®šå‡½æ•°ä½“å†…çš„ this å€¼ã€‚

3. è§£æ„èµ‹å€¼ï¼ˆDestructuring Assignmentï¼‰ï¼šå¯ä»¥ä»æ•°ç»„æˆ–å¯¹è±¡ä¸­å¿«é€Ÿæå–å€¼ï¼Œå¹¶å°†å®ƒä»¬åˆ†é…ç»™å˜é‡ï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ–¹ä¾¿çš„èµ‹å€¼æ“ä½œã€‚

4. é»˜è®¤å‚æ•°ï¼ˆDefault Parametersï¼‰ï¼šåœ¨å‡½æ•°å®šä¹‰ä¸­ï¼Œå¯ä»¥ä¸ºå‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå½“è°ƒç”¨å‡½æ•°æ—¶æ²¡æœ‰æä¾›è¯¥å‚æ•°æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚

5. æ¨¡æ¿å­—é¢é‡ï¼ˆTemplate Literalsï¼‰ï¼šä½¿ç”¨åå¼•å· åŒ…å›´çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥åŒ…å«å˜é‡ã€è¡¨è¾¾å¼å’Œæ¢è¡Œç¬¦ï¼Œå¹¶ä½¿ç”¨ ${} è¯­æ³•è¿›è¡Œæ’å€¼ã€‚

6. æ‰©å±•è¿ç®—ç¬¦ï¼ˆSpread Operatorï¼‰ï¼šé€šè¿‡ä½¿ç”¨ ... è¯­æ³•ï¼Œå¯ä»¥å°†æ•°ç»„æˆ–å¯¹è±¡åœ¨å‡½æ•°è°ƒç”¨ã€æ•°ç»„å­—é¢é‡æˆ–å¯¹è±¡å­—é¢é‡ä¸­å±•å¼€ï¼Œä½¿å…¶å…ƒç´ æˆ–å±æ€§è¢«æ‹†åˆ†æˆç‹¬ç«‹çš„é¡¹ã€‚

7. ç±»å’Œæ¨¡å—ï¼ˆClasses and Modulesï¼‰ï¼šå¼•å…¥äº†ç±»å’Œæ¨¡å—çš„æ¦‚å¿µï¼Œå¯ä»¥æ›´ç®€æ´åœ°å®šä¹‰å’Œç»„ç»‡å¯¹è±¡çš„è¡Œä¸ºå’Œç»“æ„ã€‚

8. async/awaitï¼ˆPromisesï¼‰ï¼šå¼•å…¥äº† Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œä½¿å¾—å¼‚æ­¥ä»£ç æ›´æ˜“äºç¼–å†™å’Œç®¡ç†ã€‚

9. for...of å¾ªç¯ï¼ˆFor...of Loopï¼‰ï¼šæä¾›äº†ä¸€ç§ç®€å•çš„éå†æ•°ç»„ã€å­—ç¬¦ä¸²å’Œå…¶ä»–å¯è¿­ä»£å¯¹è±¡çš„æ–¹å¼ã€‚

10 æ¨¡å—åŒ–å¯¼å…¥å’Œå¯¼å‡ºï¼ˆModule Import and Exportï¼‰ï¼šé€šè¿‡ import å’Œ export å…³é”®å­—ï¼Œæ”¯æŒæ¨¡å—åŒ–çš„æ–‡ä»¶å¯¼å…¥å’Œå¯¼å‡ºï¼Œæ–¹ä¾¿ä»£ç çš„ç»„ç»‡å’Œå¤ç”¨ã€‚

### 12.å°†ä¸¤ä¸ªæ•°ç»„çš„å…ƒç´ åˆå¹¶å¹¶å»é‡

```js
const array1 = [1, 2, 3];
const array2 = [2, 3, 4];

// å°†ä¸¤ä¸ªæ•°ç»„åˆå¹¶
const mergedArray = [...array1, ...array2];

// å»é‡
const uniqueArray = [...new Set(mergedArray)];

console.log(uniqueArray);
```

### 13.åˆ—ä¸¾å‡ ä¸ªå¤„ç†å¼‚æ­¥è¯·æ±‚åµŒå¥—çš„æ–¹æ³•

```js
// åµŒå¥—å›è°ƒå‡½æ•°å¤„ç†å¼‚æ­¥è¯·æ±‚
asyncRequest1((err,res) => {
  asyncRequest2(() => {
    asyncRequest3(() => {
      console.log('All requests completed.');
    });
  });
});

function asyncRequest3() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('Async Request 3 Completed');
      resolve();
    }, 1000);
  });
}

// ä½¿ç”¨ Promise é“¾å¼è°ƒç”¨å¤„ç†å¼‚æ­¥è¯·æ±‚
asyncRequest1()
  .then(() => asyncRequest2())
  .then(() => asyncRequest3())
  .then(() => {
    console.log('All requests completed.');
  });

// ä½¿ç”¨ async/await å¤„ç†å¼‚æ­¥è¯·æ±‚
async function nestedAsyncRequests() {
  await asyncRequest1();
  await asyncRequest2();
  await asyncRequest3();

  console.log('All requests completed.');
}

// ä½¿ç”¨ Promise.all å¹¶è¡Œå¤„ç†å¼‚æ­¥è¯·æ±‚
Promise.all([asyncRequest1(), asyncRequest2(), asyncRequest3()])
  .then(results => {
    console.log('All requests completed.');
    console.log('Results:', results);
  });
```
### 14. ç”¨ ts å®ç°å¤šæ€ï¼Œçˆ¶ç±» animalï¼Œå­ç±» cat å’Œ dogï¼ŒåŒ…å« name å±æ€§ï¼Œå®ç° say æ–¹æ³•
```ts
class Animal {
  name: string;

  constructor(name: string) {
    this.name = name;
  }

  say(): void {
    console.log('Animal says...');
  }
}

class Cat extends Animal {
  say(): void {
    console.log('Meow!');
  }
}

class Dog extends Animal {
  say(): void {
    console.log('Woof!');
  }
}

// å¤šæ€æ€§çš„åº”ç”¨
const animals: Animal[] = [new Cat('Tom'), new Dog('Max'), new Cat('Kitty')];

animals.forEach((animal) => {
  console.log(`Name: ${animal.name}`);
  animal.say();
  console.log('------------------');
});

// yarn add global ts-node typescript
// npx ts-node test.ts
```

### 15.å¦‚ä½•ä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªå˜é‡æ¥äº¤æ¢ä¸¤ä¸ªæ•°çš„å€¼?

```js
let a = 10;
let b = 5;

a = a + b; // å°† a çš„å€¼ä¸ b ç›¸åŠ ï¼Œç»“æœèµ‹ç»™ a
b = a - b; // ç”¨æ–°çš„ a å€¼å‡å»åŸå§‹çš„ b å€¼ï¼Œç»“æœèµ‹ç»™ b
a = a - b; // ç”¨æ–°çš„ a å€¼å‡å»æ–°çš„ b å€¼ï¼Œç»“æœèµ‹ç»™ a

console.log(a); // è¾“å‡º 5
console.log(b); // è¾“å‡º 10
```

```js
let a = 10;
let b = 5;

a = a ^ b; // å¯¹ a å’Œ b è¿›è¡Œä½å¼‚æˆ–æ“ä½œï¼Œç»“æœèµ‹ç»™ a
b = a ^ b; // ç”¨æ–°çš„ a å€¼ä¸åŸå§‹çš„ b å€¼è¿›è¡Œä½å¼‚æˆ–æ“ä½œï¼Œç»“æœèµ‹ç»™ b
a = a ^ b; // ç”¨æ–°çš„ a å€¼ä¸æ–°çš„ b å€¼è¿›è¡Œä½å¼‚æˆ–æ“ä½œï¼Œç»“æœèµ‹ç»™ a

console.log(a); // è¾“å‡º 5
console.log(b); // è¾“å‡º 10
```

### 16.ç®€è¿°è´Ÿè´£é¡¹ç›®ä¸­çš„è·¨æœè®¾è®¡å’Œå­˜å‚¨è®¾è®¡

```js
å½“æ¶‰åŠåˆ°å…·ä½“çš„è·¨æœè®¾è®¡å’Œå­˜å‚¨è®¾è®¡æ—¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®è·µå’ŒæŠ€æœ¯ï¼š

è·¨æœè®¾è®¡ï¼š

é€šä¿¡åè®®å’Œæ¥å£ï¼šä½¿ç”¨æ ‡å‡†çš„ç½‘ç»œåè®®ï¼ˆå¦‚HTTPã€WebSocketï¼‰æˆ–è‡ªå®šä¹‰åè®®è¿›è¡ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œé€šè¿‡å®šä¹‰æ¸…æ™°çš„æ¥å£è§„èŒƒæ¥å®ç°è·¨æœåŠ¡å™¨é€šä¿¡å’Œæ•°æ®äº¤æ¢ã€‚
è´Ÿè½½å‡è¡¡å’Œè·¯ç”±ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆå¦‚Nginxã€HAProxyï¼‰å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œæ ¹æ®è´Ÿè½½æƒ…å†µå’Œå¥åº·çŠ¶å†µæ¥åŠ¨æ€è°ƒæ•´æµé‡åˆ†é…ã€‚
æ•°æ®åŒæ­¥å’Œå…±äº«ï¼šä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚Redisï¼‰æˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Kafkaã€RabbitMQï¼‰æ¥å®ç°æ•°æ®çš„åŒæ­¥å’Œå…±äº«ï¼Œç¡®ä¿æ•°æ®åœ¨ä¸åŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚
å¼‚å¸¸å¤„ç†å’Œæ•…éšœè½¬ç§»ï¼šå®æ–½ç›‘æ§å’Œè‡ªåŠ¨åŒ–è¿ç»´ç­–ç•¥ï¼Œå½“æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæˆ–å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨è¿›è¡Œæ•…éšœè½¬ç§»å’Œæ¢å¤æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚
å­˜å‚¨è®¾è®¡ï¼š

æ•°æ®åº“é€‰æ‹©ï¼šæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©é€‚å½“çš„æ•°æ®åº“ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚MySQLã€PostgreSQLï¼‰é€‚åˆå¤„ç†å¤æ‚çš„æ•°æ®å…³ç³»ï¼Œæ–‡æ¡£æ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰é€‚åˆå­˜å‚¨çµæ´»çš„éç»“æ„åŒ–æ•°æ®ã€‚
æ•°æ®åº“æ¨¡å¼è®¾è®¡ï¼šæ ¹æ®é¡¹ç›®çš„æ•°æ®ç»“æ„å’ŒæŸ¥è¯¢éœ€æ±‚ï¼Œè®¾è®¡åˆç†çš„æ•°æ®åº“æ¨¡å¼ã€‚åŒ…æ‹¬è¡¨ç»“æ„ã€ç´¢å¼•è®¾è®¡ã€å…³ç³»å®šä¹‰å’Œæ•°æ®åˆ†ç‰‡ç­‰ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œæ•°æ®è®¿é—®æ•ˆç‡ã€‚
æ•°æ®ç¼“å­˜å’Œç¼“å­˜ç­–ç•¥ï¼šä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼ˆå¦‚Redisã€Memcachedï¼‰ç¼“å­˜å¸¸ç”¨çš„æ•°æ®ï¼Œä»¥å‡å°‘æ•°æ®åº“æŸ¥è¯¢å’Œæé«˜å“åº”é€Ÿåº¦ã€‚é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥ï¼Œå¦‚è¿‡æœŸæ—¶é—´ã€LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç­‰ã€‚
æ•°æ®å¤‡ä»½å’Œæ¢å¤ï¼šå®šæœŸè¿›è¡Œæ•°æ®å¤‡ä»½ï¼Œå¹¶åˆ¶å®šåˆé€‚çš„å¤‡ä»½ç­–ç•¥ï¼ˆå¦‚å…¨é‡å¤‡ä»½ã€å¢é‡å¤‡ä»½ï¼‰ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå¹¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤æ•°æ®ã€‚
æ•°æ®å®‰å…¨å’Œæƒé™æ§åˆ¶ï¼šå®æ–½ä¸¥æ ¼çš„æ•°æ®å®‰å…¨æªæ–½ï¼ŒåŒ…æ‹¬æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€èº«ä»½éªŒè¯å’Œæˆæƒç­‰ï¼Œä»¥ä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚
è¿™äº›æ˜¯è·¨æœè®¾è®¡å’Œå­˜å‚¨è®¾è®¡çš„ä¸€äº›å¸¸è§å®è·µå’ŒæŠ€æœ¯ï¼Œå…·ä½“çš„å®ç°æ–¹å¼å’Œå·¥å…·é€‰æ‹©ä¼šæ ¹æ®é¡¹ç›®çš„éœ€æ±‚ã€è§„æ¨¡å’ŒæŠ€æœ¯æ ˆè€Œæœ‰æ‰€å·®å¼‚ã€‚å»ºè®®åœ¨å®æ–½å…·ä½“è®¾è®¡æ—¶ç»“åˆå®é™…æƒ…å†µï¼Œè¿›è¡Œåˆç†çš„æ¶æ„å’ŒæŠ€æœ¯é€‰æ‹©ã€‚
```

### 17.ç°æœ‰ 1000 ä¸ªè‹¹æœï¼Œ10 ä¸ªç›’å­ï¼Œé—®å„ä¸ªç›’å­å†…åº”è¯¥åˆ†åˆ«æ”¾å…¥å¤šå°‘ä¸ªè‹¹æœï¼Œæ‰èƒ½ä½¿å¾—ç”¨æˆ·è¦ä¹°ä»»æ„1 è‡³ 1000 ä¹‹é—´çš„ä¸€ä¸ªè‹¹æœæ•°ï¼Œéƒ½å¯ä»¥ç»™ä»– 

> (å–çš„æ—¶å€™æ˜¯æ•´ä¸ªç›’å­å–ï¼Œä¸èƒ½æ‹†ç›’å­çš„åŒ…è£…)ã€‚

```js
ç›’å­1ï¼ˆç¬¬1ä½ï¼‰æ”¾å…¥1ä¸ªè‹¹æœã€‚
ç›’å­2ï¼ˆç¬¬2ä½ï¼‰æ”¾å…¥2ä¸ªè‹¹æœã€‚
ç›’å­3ï¼ˆç¬¬3ä½ï¼‰æ”¾å…¥4ä¸ªè‹¹æœã€‚
ç›’å­4ï¼ˆç¬¬4ä½ï¼‰æ”¾å…¥8ä¸ªè‹¹æœã€‚
ç›’å­5ï¼ˆç¬¬5ä½ï¼‰æ”¾å…¥16ä¸ªè‹¹æœã€‚
ç›’å­6ï¼ˆç¬¬6ä½ï¼‰æ”¾å…¥32ä¸ªè‹¹æœã€‚
ç›’å­7ï¼ˆç¬¬7ä½ï¼‰æ”¾å…¥64ä¸ªè‹¹æœã€‚
ç›’å­8ï¼ˆç¬¬8ä½ï¼‰æ”¾å…¥128ä¸ªè‹¹æœã€‚
ç›’å­9ï¼ˆç¬¬9ä½ï¼‰æ”¾å…¥256ä¸ªè‹¹æœã€‚
ç›’å­10ï¼ˆç¬¬10ä½ï¼‰æ”¾å…¥475ä¸ªè‹¹æœï¼ˆå‰©ä½™çš„è‹¹æœæ•°é‡ï¼‰ã€‚
```

---
## KeLuoDa

### 1. ä¸èƒ½ä½¿ç”¨ await çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä¿è¯ä¸²è¡Œ

> åœ¨ä¸èƒ½ä½¿ç”¨awaitçš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å›è°ƒå‡½æ•°ã€Promise é“¾ã€æˆ–è€… Generator å‡½æ•°æ¥ä¿è¯å¼‚æ­¥æ“ä½œçš„ä¸²è¡Œæ‰§è¡Œã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ åœ¨ä¸é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹æŒ‰é¡ºåºæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ã€‚

ä½¿ç”¨å›è°ƒå‡½æ•°ï¼š
```js
function task1(callback) {
    // å¼‚æ­¥ä»»åŠ¡1
    setTimeout(() => {
        console.log("Task 1 complete");
        callback();
    }, 1000);
}

function task2(callback) {
    // å¼‚æ­¥ä»»åŠ¡2
    setTimeout(() => {
        console.log("Task 2 complete");
        callback();
    }, 2000);
}

task1(() => {
    task2(() => {
        // æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        console.log("All tasks complete");
    });
});

```

ä½¿ç”¨Promiseé“¾ï¼š
```javascript
function task1() {
    return new Promise((resolve) => {
        // å¼‚æ­¥ä»»åŠ¡1
        setTimeout(() => {
            console.log("Task 1 complete");
            resolve();
        }, 1000);
    });
}

function task2() {
    return new Promise((resolve) => {
        // å¼‚æ­¥ä»»åŠ¡2
        setTimeout(() => {
            console.log("Task 2 complete");
            resolve();
        }, 2000);
    });
}

task1()
    .then(() => task2())
    .then(() => {
        // æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        console.log("All tasks complete");
    });

```

ä½¿ç”¨Generatorå‡½æ•°ï¼š

```javascript

function* main() {
    yield task1();
    yield task2();
    // æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    console.log("All tasks complete");
}

function task1() {
    return new Promise((resolve) => {
        // å¼‚æ­¥ä»»åŠ¡1
        setTimeout(() => {
            console.log("Task 1 complete");
            resolve();
        }, 1000);
    });
}

function task2() {
    return new Promise((resolve) => {
        // å¼‚æ­¥ä»»åŠ¡2
        setTimeout(() => {
            console.log("Task 2 complete");
            resolve();
        }, 2000);
    });
}

const iterator = main();

function run(iterator) {
    const { value, done } = iterator.next();
    if (!done) {
        value.then(() => run(iterator));
    }
}

run(iterator);
```
::: tip
è¿™äº›æ–¹æ³•ä¸­ï¼Œå›è°ƒå‡½æ•°æ˜¯æœ€åŸºæœ¬çš„æ–¹å¼ï¼Œä½†å®¹æ˜“å¯¼è‡´å›è°ƒåœ°ç‹±ã€‚Promise é“¾æ›´æ¸…æ™°ä¸€äº›ï¼Œå¹¶ä¸”æ”¯æŒæ›´å¥½çš„é”™è¯¯å¤„ç†ã€‚Generator å‡½æ•°å…è®¸ä½ ä½¿ç”¨åŒæ­¥çš„ä»£ç ç»“æ„æ¥ç¼–å†™å¼‚æ­¥ä»»åŠ¡ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥ä¿è¯å¼‚æ­¥ä»»åŠ¡çš„ä¸²è¡Œæ‰§è¡Œã€‚
::: 


### 2. node è®¾ç½®ä½¿ç”¨å†…å­˜å¤§å°

> é»˜è®¤ä¸º4GBï¼Œä¸åŒæœºå™¨å¯èƒ½æœ‰ä¸åŒ

```bash
node --max-old-space-size=2048 your-app.js
```

### 3. å¦‚ä½•é¢„é˜²XSSæ”»å‡»ï¼Ÿ

> ğŸ‘€ é¢„é˜²è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰æ˜¯æ„å»ºå®‰å…¨ web åº”ç”¨ç¨‹åºçš„é‡è¦ä¸€ç¯ã€‚XSS æ”»å‡»çš„ç›®æ ‡æ˜¯å‘ç½‘é¡µæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä»¥ä¾¿æ”»å‡»è€…å¯ä»¥çªƒå–ç”¨æˆ·çš„ä¿¡æ¯æˆ–æ‰§è¡Œæ¶æ„æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é˜²æ­¢ XSS æ”»å‡»çš„æœ€ä½³å®è·µï¼š

1. è¾“å…¥éªŒè¯å’Œè¿‡æ»¤ï¼š

å¯¹äºæ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼ŒåŒ…æ‹¬è¡¨å•è¾“å…¥ã€URL å‚æ•°å’Œ cookieï¼Œéƒ½è¦è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤ã€‚åªå…è®¸é¢„æœŸçš„ã€åˆæ³•çš„å­—ç¬¦å’Œæ•°æ®é€šè¿‡ã€‚

2. è½¬ä¹‰è¾“å‡º
åœ¨å°†ç”¨æˆ·è¾“å…¥æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šä¹‹å‰ï¼Œç¡®ä¿å¯¹å…¶è¿›è¡Œé€‚å½“çš„è½¬ä¹‰ã€‚è¿™å¯ä»¥é€šè¿‡ç¼–ç¨‹è¯­è¨€çš„å†…ç½®å‡½æ•°æˆ–æ¨¡æ¿å¼•æ“æ¥å®Œæˆï¼Œä»¥ç¡®ä¿ä»»ä½•ç”¨æˆ·è¾“å…¥éƒ½ä¸ä¼šè¢«è§£é‡Šä¸ºä»£ç ã€‚ä½¿ç”¨å®‰å…¨çš„ HTMLã€CSS å’Œ JavaScript è¾“å‡ºç¼–ç æ–¹æ³•ï¼Œ

```js
å¦‚ htmlspecialchars()ã€encodeURIComponent(),md5() ç­‰ã€‚
```

3. å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)ï¼š
é…ç½® CSP å¤´ï¼Œé™åˆ¶æµè§ˆå™¨åŠ è½½å’Œæ‰§è¡Œçš„å†…å®¹ã€‚CSP å¯ä»¥é˜»æ­¢å†…è”è„šæœ¬å’Œå…¶ä»–ä¸å—ä¿¡ä»»çš„å†…å®¹ï¼Œå‡å°‘ XSS æ”»å‡»çš„é£é™©ã€‚
åœ¨ HTTP å¤´ä¸­åŒ…å« Content-Security-Policy æ¥å¯ç”¨ CSPã€‚

```js
Content-Security-Policy: same-origin // åªå…è®¸åŠ è½½åŒæºçš„èµ„æº  
Content-Security-Policy: default-src 'self' www.example.com // åªå…è®¸åŠ è½½åŒæºçš„èµ„æºå’Œ www.example.com åŸŸåä¸‹çš„èµ„æº
Content-Security-Policy: script-src 'none'
```

4. HTTP Only å’Œ Secure Cookiesï¼š
ä½¿ç”¨ HttpOnly æ ‡å¿—æ¥è®¾ç½® cookieï¼Œä»¥é˜²æ­¢ JavaScript è®¿é—® cookie æ•°æ®ã€‚
åœ¨éœ€è¦å®‰å…¨è¿æ¥çš„æƒ…å†µä¸‹ï¼Œè®¾ç½® Secure æ ‡å¿—æ¥ç¡®ä¿ cookie åªé€šè¿‡ HTTPS è¿æ¥ä¼ è¾“ã€‚

```js
// æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆNode.jsç¤ºä¾‹ï¼‰
const express = require('express');
const cookieParser = require('cookie-parser');
const app = express();

app.use(cookieParser());

app.get('/set-cookie', (req, res) => {
  // åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®ä¸€ä¸ª HTTP Only çš„ cookie
  res.cookie('myCookie', 'cookieValue', { httpOnly: true });
  res.send('HTTP Only cookie set.');
});
```
  
### 4. httpå’Œhttpsçš„åŒºåˆ«ï¼Ÿè¯ä¹¦è®¤è¯è¿‡ç¨‹ï¼Ÿpkiï¼Ÿ

|          | http | https |
| -------- | ---- | ----- |
| ä¼ è¾“åè®® | æ˜æ–‡ | åŠ å¯†  |
| é»˜è®¤ç«¯å£ | 80   | 443   |
| è¯ä¹¦     | æ—    | æœ‰    |

HTTPSè¯ä¹¦è®¤è¯è¿‡ç¨‹:

1. æœåŠ¡å™¨ç«¯è¯ä¹¦ç”Ÿæˆ:
æœåŠ¡å™¨ç®¡ç†å‘˜ç”Ÿæˆä¸€ä¸ªè¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰ï¼Œå…¶ä¸­åŒ…å«æœåŠ¡å™¨çš„å…¬é’¥ã€‚
è¯ä¹¦è¯·æ±‚è¢«å‘é€åˆ°å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ã€‚

1. è¯ä¹¦é¢å‘æœºæ„è®¤è¯:
CA éªŒè¯è¯ä¹¦è¯·æ±‚çš„åˆæ³•æ€§ï¼Œå¹¶éªŒè¯æœåŠ¡å™¨æ‰€æœ‰è€…çš„èº«ä»½ã€‚
CA ç­¾å‘åŒ…å«æœåŠ¡å™¨å…¬é’¥çš„æ•°å­—è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨ CA çš„ç§é’¥è¿›è¡Œç­¾åã€‚

1. æœåŠ¡å™¨é…ç½®è¯ä¹¦:
æœåŠ¡å™¨æ”¶åˆ° CA ç­¾å‘çš„è¯ä¹¦åï¼Œå°†å…¶é…ç½®åˆ°æœåŠ¡å™¨ä¸Šã€‚

1. å®¢æˆ·ç«¯éªŒè¯:
å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›è¯ä¹¦ã€‚
å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¼šéªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼ŒåŒ…æ‹¬æ£€æŸ¥ CA çš„ç­¾åå’Œè¯ä¹¦æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ã€‚
å¦‚æœè¯ä¹¦æœ‰æ•ˆï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºçš„å¯¹ç§°å¯†é’¥ï¼Œç„¶åä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†å®ƒï¼Œå¹¶å°†å…¶å‘é€å›æœåŠ¡å™¨ã€‚
å»ºç«‹å®‰å…¨é€šä¿¡:

::: tip
æœåŠ¡å™¨ä½¿ç”¨å…¶ç§é’¥è§£å¯†å®¢æˆ·ç«¯å‘é€çš„éšæœºå¯†é’¥ã€‚
ä»æ­¤åˆ»èµ·ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡éƒ½ä½¿ç”¨è¿™ä¸ªå…±äº«çš„å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚
:::

#### å…¬é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰:

- PKI æ˜¯ä¸€ç§å¹¿æ³›ç”¨äºåŠ å¯†å’Œè®¤è¯çš„ä½“ç³»ç»“æ„ã€‚å®ƒåŒ…æ‹¬è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰å’Œæ•°å­—è¯ä¹¦ï¼Œç”¨äºç¡®ä¿å®‰å…¨é€šä¿¡ã€‚PKI çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œå…¶ä¸­æ¯ä¸ªå®ä½“ï¼ˆå¦‚æœåŠ¡å™¨æˆ–ç”¨æˆ·ï¼‰éƒ½æœ‰ä¸€å¯¹å…¬é’¥å’Œç§é’¥ã€‚ç§é’¥æ˜¯ä¿å¯†çš„ï¼Œè€Œå…¬é’¥å¯ä»¥å…¬å¼€ä½¿ç”¨ã€‚CA é¢å‘æ•°å­—è¯ä¹¦ï¼Œç”¨äºéªŒè¯å…¬é’¥çš„çœŸå®æ€§å’Œèº«ä»½ã€‚

- åœ¨ HTTPS ä¸­ï¼ŒPKI ç”¨äºç¡®ä¿æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ååŠ©åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹åŠ å¯†é€šä¿¡ã€‚é€šè¿‡ CA é¢å‘çš„æ•°å­—è¯ä¹¦ï¼Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œä»è€Œç¡®ä¿å®ƒæ­£åœ¨ä¸é¢„æœŸçš„å®‰å…¨æœåŠ¡å™¨é€šä¿¡ã€‚

> æ€»ä¹‹ï¼ŒHTTP æ˜¯ä¸€ç§ä¸å®‰å…¨çš„åè®®ï¼Œè€Œ HTTPS ä½¿ç”¨åŠ å¯†å’Œæ•°å­—è¯ä¹¦æ¥ä¿æŠ¤é€šä¿¡çš„å®‰å…¨æ€§å’ŒçœŸå®æ€§ã€‚ PKI æ˜¯ HTTPS çš„åŸºç¡€ï¼Œç”¨äºéªŒè¯å’ŒåŠ å¯†é€šä¿¡ã€‚

### 5. ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯å¦å…±äº«å†…å­˜ï¼Ÿ

> åœ¨ Node.js ä¸­ï¼Œä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´ä¸å…±äº«å†…å­˜ã€‚ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå®ƒä»¬æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹å†…å­˜ç©ºé—´ã€‚è¿™æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„åˆ†ç¦»ã€‚

å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œæ¯ä¸ªå­è¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ JavaScript æ‰§è¡Œç¯å¢ƒå’Œå†…å­˜ç©ºé—´ã€‚è¿™æ„å‘³ç€ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´ä¸èƒ½ç›´æ¥å…±äº«å˜é‡æˆ–æ•°æ®ï¼Œé™¤éä½ æ˜ç¡®åœ°ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡ï¼ˆInter-Process Communicationï¼ŒIPCï¼‰æœºåˆ¶æ¥å®ç°æ•°æ®ä¼ é€’ï¼Œä¾‹å¦‚ä½¿ç”¨ `child_process` æ¨¡å—çš„ `send()` å’Œ `on('message')` æ–¹æ³•ã€‚

### ZStack

[Node.js äº‹ä»¶å¾ªç¯æœºåˆ¶](/backend/node/node/#%E2%AD%90%EF%B8%8F-%E2%AD%90%EF%B8%8F-7-node-js-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6)