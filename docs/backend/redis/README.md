---
title: Redis å­¦ä¹ ç¬”è®°
date: 2025-6-18
categories:
  - Backend
tags:
  - redis
sidebar: "auto"
publish: true
---

## Redis æ¦‚å¿µ

[ã€å°šç¡…è°·ã€‘Redis 6 å…¥é—¨åˆ°ç²¾é€š è¶…è¯¦ç»† æ•™ç¨‹](https://www.bilibili.com/video/BV1Rv41177Af)

[cVå±•ç¤ºçš„å­¦ä¹ å›­ (è¿™äººç¬”è®°å†™çš„å¾ˆå¥½)](https://blog.csdn.net/qq_45408390/category_11225849.html)

> Redis(Remote Dictinary Server),C è¯­è¨€å¼€å‘,é«˜æ€§èƒ½(key-value)æ•°æ®åº“, **å•çº¿ç¨‹ + å¤šè·¯ IO å¤ç”¨**

## Docker & Redis-Cli

```shell
docker run -d --name redis -p 6379:6379 --restart always redis # Ahaï¼Œé¡ºä¾¿è®¾ç½®è‡ªå¯åŠ¨
docker exec -it redis redis-cli
```

### Redis-Cli-Test

```shell
127.0.0.1:6379> ping
PONG # çœ‹åˆ°è¿™ä¸ªå°±ä»£è¡¨æˆåŠŸäº†
```

## Redis äº”å¤§æ•°æ®ç±»å‹

::: warning 
- String (90%+) ï¼Œ äºŒè¿›åˆ¶å®‰å…¨
- List ï¼ŒåŒå‘é“¾è¡¨
- Set ï¼Œè‡ªåŠ¨å»é‡ ï¼Œå­—å…¸
- Hash ï¼Œç±»ä¼¼ HashMapï¼Œå­˜å‚¨é”®å€¼å¯¹
- Zset ï¼Œæœ‰åºé›†åˆï¼Œscoreï¼ˆä»å°åˆ°å¤§æ’åˆ—ï¼‰
:::

### Medis

[ã€Macã€‘Medis For Redis GUI](https://getmedis.com/)

[ã€Windowsã€‘Another Redis Desktop Manager](https://github.com/qishibo/AnotherRedisDesktopManager/releases/tag/v1.5.5)

## Redis åŸºæœ¬æ“ä½œ

### Key å¸¸ç”¨å‘½ä»¤

```shell
keys *

exists key # åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨

del key # åŒæ­¥åˆ é™¤
unlink key # å¼‚æ­¥åˆ é™¤

expire key 10 # ç»™keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯ç§’
ttl key # time-to-live,æŸ¥çœ‹keyè¿˜æœ‰å¤šä¹…è¿‡æœŸï¼Œ-1æ°¸ä¸è¿‡æœŸï¼Œ-2å·²è¿‡æœŸ

select 1 # åˆ‡æ¢æ•°æ®åº“

dbsize # æŸ¥çœ‹å½“å‰æ•°æ®åº“keysçš„æ•°é‡

flushdb # æ¸…ç©ºå½“å‰æ•°æ®åº“
flushall # æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“
```

### String å¸¸ç”¨å‘½ä»¤

```shell
set k1 111
get k1

mset k1 v1 k2 v2 ...
msetnx k1 v1 k2 v2 ... # åŸå­æ€§
mget k1 k2 ...

strlen k1 # è·å¾—k1çš„é•¿åº¦

setnx k1 111 #setnx åªæœ‰keyä¸å­˜åœ¨æ—¶æ‰èƒ½æˆåŠŸ

getrange k1 1 2 # (java) = k1.substring(1,2)
setrange k1 1 2 value

setex k1 600 v1 # åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´
getset k1 v2 # è¯» & è®¾ç½®æ–°å€¼

# ä»¥ä¸‹å‘½ä»¤æ˜¯åŸå­æ€§æ“ä½œï¼ˆä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­ï¼‰
incr k1  # +1
decr k1  # -1

incrby k1 10 # +10
decrby k1 10 # -10
```

### list å¸¸ç”¨å‘½ä»¤

```shell
lpush / rpush k1 v1 k2 v2 ...
lpop / rpop k1 # ä¸œè¥¿å¼¹å…‰äº†keyå°±æ¶ˆå¤±äº†

rpoplpush k1 k2 # å³å¼¹ + å·¦æ’

lrange k1 0 -1 # <start> <stop> , å…¶ä¸­ 0 -1 ä»£è¡¨å–æ‰€æœ‰å€¼

lindex k1 1

llen k1

linsert k2 before/after k1 "value"

lrem k1 2 "value1" # ä»k1å·¦è¾¹åˆ é™¤2ä¸ªvalue1

lset k1 1 "value2" # å°†k1ä¸­ä¸‹æ ‡ä¸º1çš„å€¼æ›¿æ¢æˆâ€œvalue2â€
```

### Set å¸¸ç”¨å‘½ä»¤

```shell
sadd set1 v1 v2 v3

smember set1
sismember set1 v1 # åˆ¤æ–­set1ä¸­æœ‰æ— v1è¿™ä¸ªå€¼

scard set1 # è¿”å›set1ä¸­å…ƒç´ ä¸ªæ•°

srem set1 v1 v2 ... # åˆ é™¤é›†åˆä¸­çš„å…ƒç´ 

spop set1 # éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼

srandmember set1 3 # éšæœºä»set1ä¸­å–å‡º3ä¸ªå€¼ï¼Œä½†ä¸ä¼šåˆ é™¤å®ƒä»¬

smove k1 k2 v3 # æŠŠv3ä»k1ç§»åˆ°k2ä¸­

sinter k1 k2 # äº¤é›†

sunion k1 k2 # å¹¶é›†

sdiff k1 k2 # å·®é›†
```

### Hash å¸¸ç”¨å‘½ä»¤

```shell
hset user id 611
hset user name liuliyi

hmset user id 1 name liuliyi611 age 24 # æ‰¹é‡è®¾ç½®

HEXISTS user name # user.name æ˜¯å¦å­˜åœ¨

HKEYS user # æŸ¥è¯¢userçš„æ‰€æœ‰key
HVALS user # æŸ¥è¯¢userçš„æ‰€æœ‰value
HGETALL user # ä¸€æ¬¡æ€§æŸ¥è¯¢userçš„æ‰€æœ‰å†…å®¹

HINCRBY user age 10 # user.age += 10

HSETNX user wife sara # åªæœ‰æ²¡æœ‰æ­¤å±æ€§ï¼Œæ‰èƒ½è®¾ç½®æˆåŠŸ
```

### ZSet å¸¸ç”¨å‘½ä»¤

```shell

zadd top 100 user1 90 user2 80 user3  # ä»å°åˆ°å¤§æ’åˆ—

zrange top 0 -1
zrange top 0 -1 withscores # withscores ä¼šå¸¦ä¸Šåˆ†æ•°ä¸€èµ·æ˜¾ç¤º

zrangebyscore top 90 100 # æ˜¾ç¤º top ä¸­ 90ï½100 åˆ†çš„
zrangebyscore top 90 100 withscores

ZREVRANGEBYSCORE top 100 80 # ä»å¤§åˆ°å°æ’åˆ—
ZREVRANGEBYSCORE top 100 80 withscores

ZINCRBY top 50 user1 # ç»™topä¸­çš„user1åŠ 50

ZREM top user

ZCOUNT top 70 100

ZRANK top user2
```

## Redis é…ç½®æ–‡ä»¶

[Redis6 ç¯‡ ï¼ˆäºŒï¼‰é…ç½®æ–‡ä»¶çš„ä»‹ç»](https://blog.csdn.net/qq_45408390/article/details/119730969)

## Redis å‘å¸ƒ & è®¢é˜…

```shell
subscribe channel1 # Terminal 1
publish channel1 hello #Terminal 2
```

## Redis æ–°æ•°æ®ç±»å‹

[Redis6 ç¯‡ ï¼ˆä¸‰ï¼‰Redis æ–°æ•°æ®ç±»å‹](https://blog.csdn.net/qq_45408390/article/details/119731008)

### BitMaps

> åˆ©ç”¨äºŒè¿›åˆ¶æ‰©å±•æˆå­—ç¬¦ä¸²çš„æ–¹å¼å­˜å‚¨æ•°æ®,å¯ç”¨äºæŸ¥æ‰¾ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡æŸæ–‡ç« 

> "abc" = "01100001" + "01100010" + "01100011" = "011000010110001001100011"

```shell
SETBIT bitmap1 1 1
GETBIT bitmap1 1  # 1
GETBIT bitmap1 2  # 0

BITCOUNT bitmap1 # è®¡ç®—bitmap1.count(ä¸‹æ ‡=1)
BITCOUNT bitmap1 [start] [end] # å¯ä»¥è‡ªå®šä¹‰countèŒƒå›´,å…¶ä¸­-1ä»£è¡¨å€’æ•°ç¬¬ä¸€ä½,-2æ˜¯å€’æ•°ç¬¬äºŒä½ï¼Œä»¥æ­¤ç±»æ¨
```

::: warning
å¯¹äºäº¿çº§ç”¨æˆ·æ¥è¯´ï¼Œä½¿ç”¨ Bitmaps èƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œä½†æ•°é‡å¾ˆå°‘çš„æƒ…å†µä¸‹é€‚å¾—å…¶å
:::

### HyperLogLog

> æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡(å»é‡åçš„å…ƒç´ ä¸ªæ•°)çš„ç®—æ³•

> HyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚

```shell
pfadd HLL1 "test1" "test2" "test3" "test1"

pfcount HLL1 # 3

pfadd HLL2 "test2" "test3" "test4"

pfcount HLL2 # 3

pfmerge HLL3 HLL1 HLL2 # æŠŠHLL1å’ŒHLL2åˆå¹¶æˆHLL3

pfcount HLL3 # 4
```

::: warning
HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚
:::

### Geospatial

> Redis 3.2 ä¸­å¢åŠ äº†å¯¹ GEO ç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™,åœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚

> redis åŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦ Hash ç­‰å¸¸è§æ“ä½œã€‚

```shell
127.0.0.1:6379> geoadd city 121.47 31.23 shanghai
(integer) 1
127.0.0.1:6379> geoadd city 106.50 29.53 chongqing
(integer) 1
127.0.0.1:6379> GEOPOS city shanghai
1) 1) "121.47000163793563843"
   2) "31.22999903975783553"
127.0.0.1:6379> GEOPOS city chongqing
1) 1) "106.49999767541885376"
   2) "29.52999957900659211"
127.0.0.1:6379> GEODIST city shanghai chongqing
"1447673.6920"
127.0.0.1:6379> GEORADIUS city 110 30 1000 km
1) "chongqing"
```

## Redis äº‹åŠ¡æ“ä½œ

[Redis6 ç¯‡ ï¼ˆäº”ï¼‰Redis äº‹åŠ¡æ“ä½œ + Redis äº‹åŠ¡-ç§’æ€æ¡ˆä¾‹](https://blog.csdn.net/qq_45408390/article/details/119731054)

### äº‹åŠ¡çš„æ¦‚è¿°

- Redis äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚
- äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚

### Multiã€Execã€discard

- ä»è¾“å…¥ Multi å‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œ
- ç›´åˆ°è¾“å…¥ Exec åï¼ŒRedis ä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œ
- ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ discard

---

```shell
127.0.0.1:6379> multi
OK
127.0.0.1:6379(TX)> flushdb
QUEUED
127.0.0.1:6379(TX)> set k1 v1
QUEUED
127.0.0.1:6379(TX)> set k2 v2
QUEUED
127.0.0.1:6379(TX)> SET k3 v3
QUEUED
127.0.0.1:6379(TX)> exec
1) OK
2) OK
3) OK
4) OK
```

```shell
127.0.0.1:6379> multi
OK
127.0.0.1:6379(TX)> del k1
QUEUED
127.0.0.1:6379(TX)> del k2
QUEUED
127.0.0.1:6379(TX)> del k3
QUEUED
127.0.0.1:6379(TX)> discard # discardåä¸Šè¿°å‘½ä»¤å…¨éƒ¨å¤±æ•ˆ
OK
127.0.0.1:6379> keys *
1) "k3"
2) "k2"
3) "k1"
```

### äº‹åŠ¡çš„é”™è¯¯å¤„ç†

- ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆ
- å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚

```shell
127.0.0.1:6379> multi
OK
127.0.0.1:6379(TX)> del k1 # è¿™å¥æ‰§è¡Œäº†
QUEUED
127.0.0.1:6379(TX)> del k2 # è¿™å¥æ‰§è¡Œäº†
QUEUED
127.0.0.1:6379(TX)> incr k3 # è¿™å¥æ²¡æ‰§è¡Œ
QUEUED
127.0.0.1:6379(TX)> exec
1) (integer) 1
2) (integer) 1
3) (error) ERR value is not an integer or out of range
127.0.0.1:6379> keys *
1) "k3"
```

### ä¹è§‚é” & æ‚²è§‚é”

::: tip

- ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Redis å°±æ˜¯åˆ©ç”¨è¿™ç§ check-and-set æœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚
  :::

::: warning

- æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š block ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚
  :::

### WATCH 

- åœ¨æ‰§è¡Œ multi ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ watch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key
- å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚

```shell
127.0.0.1:6379> get k1
"120"
127.0.0.1:6379> watch k1 # ç›‘è§† k1
OK
127.0.0.1:6379> multi
OK
127.0.0.1:6379(TX)> incrby k1 123
QUEUED

######### å¦ä¸€ä¸ªç»ˆç«¯çª—å£
127.0.0.1:6379> set k1 111 # ä¿®æ”¹äº† k1
OK
######### 

127.0.0.1:6379(TX)> exec
(nil) # åœ¨å¼€å¯äº‹åŠ¡çš„æ—¶å€™ï¼Œåœ¨æ‰§è¡Œå‰å…ˆä¿®æ”¹ä¸€ä¸‹ä¿¡æ¯ï¼Œå°±ä¼šæ‰§è¡Œå¤±è´¥ï¼Œè¿™æ˜¯watch keyçš„ä½œç”¨
```

### UNWATCH

- å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚
- å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCHäº†

## Redis æŒä¹…åŒ–

[Redis6 ç¯‡ ï¼ˆå…­ï¼‰RedisæŒä¹…åŒ–](https://blog.csdn.net/qq_45408390/article/details/119731077)

> RDB = Redis Database = åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§snapshotå†™å…¥åˆ°ç£ç›˜ä¸­

> AOF = Append Only File = ä»¥æ—¥å¿—å½¢å¼è®°å½•æ¯ä¸€ä¸ªå†™æ“ä½œï¼ˆåªè®¸è¿½åŠ ä¸å¯æ”¹å†™ï¼‰
  

### Redis æŒä¹…åŒ– AOF/ RDBçš„åŒºåˆ«å’Œé€‰æ‹©
1. RDBæŒä¹…åŒ–

- RDBæŒä¹…åŒ–æ˜¯å°†Redisä¸­çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­çš„ä¸€ç§æ–¹å¼ã€‚å½“é…ç½®äº†RDBæŒä¹…åŒ–åï¼ŒRedisä¼šå®šæœŸå°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§å†™å…¥åˆ°ç£ç›˜ä¸­ï¼Œå½¢æˆä¸€ä¸ªRDBæ–‡ä»¶ã€‚RDBæ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…å«äº†Redisåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥ç”¨äºæ¢å¤Redisçš„æ•°æ®ã€‚

> RDBæŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯å ç”¨ç©ºé—´å°ï¼Œæ•°æ®æ¢å¤é€Ÿåº¦å¿«ï¼Œé€‚åˆäºå¤‡ä»½å’Œç¾éš¾æ¢å¤ã€‚ç¼ºç‚¹æ˜¯åœ¨æŒä¹…åŒ–è¿‡ç¨‹ä¸­å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›æ•°æ®ï¼Œå› ä¸ºå®ƒåªèƒ½å®šæœŸå°†æ•°æ®å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå¦‚æœåœ¨å¿«ç…§å†™å…¥ç£ç›˜ä¹‹å‰Rediså‘ç”Ÿäº†å´©æºƒï¼Œé‚£ä¹ˆå†…å­˜ä¸­æœªä¿å­˜åˆ°ç£ç›˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚

2. AOFæŒä¹…åŒ–

- AOFæŒä¹…åŒ–æ˜¯å°†Redisä¸­çš„æ“ä½œè®°å½•ä¿å­˜åˆ°ç£ç›˜ä¸­çš„ä¸€ç§æ–¹å¼ã€‚å½“é…ç½®äº†AOFæŒä¹…åŒ–åï¼ŒRedisä¼šå°†æ¯ä¸ªå†™å…¥å‘½ä»¤è¿½åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç§°ä¸ºAOFæ–‡ä»¶ã€‚AOFæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†Redisæ‰€æœ‰çš„å†™å…¥æ“ä½œï¼Œå¯ä»¥ç”¨äºæ¢å¤Redisçš„æ•°æ®ã€‚

> AOFæŒä¹…åŒ–çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œå› ä¸ºå®ƒä¼šè®°å½•æ¯ä¸ªå†™å…¥æ“ä½œã€‚ç¼ºç‚¹æ˜¯å ç”¨ç©ºé—´å¤§ï¼Œæ¢å¤é€Ÿåº¦è¾ƒæ…¢ï¼Œé€‚åˆäºæ•°æ®é‡è¦æ€§è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ã€‚å¦å¤–ï¼Œç”±äºAOFæ–‡ä»¶ä¸­è®°å½•äº†æ‰€æœ‰çš„å†™å…¥æ“ä½œï¼Œå¦‚æœå†™å…¥æ“ä½œéå¸¸é¢‘ç¹ï¼ŒAOFæ–‡ä»¶å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ï¼Œå½±å“æ€§èƒ½ã€‚

**ç»¼ä¸Šæ‰€è¿°ï¼ŒRDBæŒä¹…åŒ–é€‚åˆäºæ•°æ®é‡è¾ƒå¤§ã€å†™å…¥æ“ä½œä¸é¢‘ç¹ã€æ•°æ®æ¢å¤é€Ÿåº¦è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œè€ŒAOFæŒä¹…åŒ–é€‚åˆäºæ•°æ®é‡è¦æ€§è¾ƒé«˜ã€å†™å…¥æ“ä½œè¾ƒä¸ºé¢‘ç¹çš„åœºæ™¯ã€‚å¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„æŒä¹…åŒ–æ–¹å¼ã€‚**

::: tip 

> å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚
> å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨RDBã€‚ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç°Bugã€‚å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚

- RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨

- AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.

- Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§

- å¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.

:::

### æ€§èƒ½å»ºè®®

```shell
å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚

å¦‚æœä½¿ç”¨AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚

ä»£ä»·,ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚

åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚

é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œcvå±•ç¤ºã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_45408390/article/details/119731077
```
## Redis ä¸»ä»å¤åˆ¶ + Redisé›†ç¾¤

[Redis6ç¯‡ ï¼ˆä¸ƒï¼‰Redisä¸»ä»å¤åˆ¶ + Redisé›†ç¾¤](https://blog.csdn.net/qq_45408390/article/details/119731094)

[Redis.conf åŸæ–‡ä»¶ + é…ç½®è¯¦è§£](https://blog.csdn.net/super1223/article/details/119060113)

![img](https://img-blog.csdnimg.cn/652465d11add436ea377bfe71c983b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center)

### æ­å»ºä¸»ä»å¤åˆ¶

[Error: No such file or directory @ rb_sysopen (ç¼ºå°‘æŸåº“çš„è§£å†³æ–¹æ³•)](https://blog.csdn.net/wq57885/article/details/121392104)

```
brew install ca-certificates # çœ‹æŠ¥é”™ï¼Œå°‘ä»€ä¹ˆbrew
```

[mac brewå®‰è£…redis (macæœ¬åœ°å®‰è£…redisï¼Œä¾¿äºæ“ä½œ)](https://www.cnblogs.com/qianmaoliugou/p/15006539.html)

```
brew install redis
```

---


<img style="border:2;" src="/img/redis-test.jpg">

---

```shell
###################### redis6379.conf #######################
include myredis/redis.conf # æµ‹è¯•ä¸­æ²¡ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå¦åˆ™å‰é¢å¢åŠ â€˜/â€™
pidfile /var/run/redis_6379.pid
port 6379
dbfilename dump6379.rdb

###################### redis6380.conf #######################
include myredis/redis.conf
pidfile /var/run/redis_6380.pid
port 6380
dbfilename dump6380.rdb

###################### redis6381.conf #######################
include myredis/redis.conf
pidfile /var/run/redis_6381.pid
port 6381
dbfilename dump6381.rdb
```
```shell
liuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6379.conf
liuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6380.conf
liuliyi@liuliyideMacBook-Pro redis-test % redis-server redis6381.conf

liuliyi@liuliyideMacBook-Pro redis-test % ps -ef | grep redis
  501  8617     1   0  3:23ä¸‹åˆ ??         0:00.63 /opt/homebrew/opt/redis/bin/redis-server 127.0.0.1:6379
  501  8685     1   0  3:30ä¸‹åˆ ??         0:00.51 redis-server 127.0.0.1:6380
  501  8687     1   0  3:30ä¸‹åˆ ??         0:00.50 redis-server 127.0.0.1:6381
  501  8841  3363   0  3:32ä¸‹åˆ ttys001    0:00.00 grep redis

liuliyi@liuliyideMacBook-Pro redis-test % redis-cli -p 6379 # è¿›å…¥æŒ‡å®šç«¯å£çš„redisæœåŠ¡
127.0.0.1:6379> info replication
# Replication
role:master
connected_slaves:0 # ç°åœ¨æ²¡æœ‰é™„å±æœº
master_failover_state:no-failover
master_replid:e44ac240b5de658e4541aa0bddf6645325214997
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0

liuliyi@liuliyideMacBook-Pro redis-test % redis-cli -p 6380
127.0.0.1:6380> slaveof 127.0.0.1 6379 # è®¾ç½®ä¸»äººä¸º6379
OK

liuliyi@liuliyideMacBook-Pro redis-test % redis-cli -p 6381
127.0.0.1:6381> slaveof 127.0.0.1 6379
OK

liuliyi@liuliyideMacBook-Pro redis-test % redis-cli -p 6379
127.0.0.1:6379> info replication
# Replication
role:master
connected_slaves:2 # æœ‰ä¸¤å°ä»æœºäº†
slave0:ip=127.0.0.1,port=6380,state=online,offset=28,lag=0
slave1:ip=127.0.0.1,port=6381,state=online,offset=28,lag=1
master_failover_state:no-failover
master_replid:0146ab97e819f0c04303677fc70f451a3f1aa244
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:28
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:28
```
::: warning Q & A
- ä»æœºä¼šã€å…¨é‡ã€‘å¤åˆ¶ä¸»æœºçš„å†…å®¹
- åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ®ï¼Œåœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™
- ä¸»æœºæŒ‚æ‰ï¼Œé‡å¯å°±è¡Œï¼Œä¸€åˆ‡å¦‚åˆï¼Œä»æœºé‡å¯éœ€é‡è®¾ï¼šslaveof 127.0.0.1 6379
- ä¸»æœºshutdownåï¼Œä»æœºåŸåœ°å¾…å‘½ï¼Œç­‰å¾…ä¸»æœºé‡æ–°å¯åŠ¨ï¼Œä¸€åˆ‡å›å¤æ­£å¸¸
:::

::: tip å¤åˆ¶åŸç†
- Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤
- Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥
- å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚
- å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥
- ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ
:::

### åå®¢ä¸ºä¸»

> ä»æœºä¹Ÿå¯ä»¥æœ‰ä»æœºï¼Œè¿˜å¯ä»¥åœ¨ä¸»æœºæŒ‚æ‰çš„æ—¶å€™åå®¢ä¸ºä¸»

``` shell
slaveof no one # åå®¢ä¸ºä¸»
```

### å“¨å…µæ¨¡å¼

> åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“

> å…ˆæ­å»ºä¸€ä¸»äºŒä»çš„ç¯å¢ƒï¼Œè‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶

```shell
###################### sentinel.conf #######################
# å…¶ä¸­mymasterä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°ï¼Œ 1 ä¸ºè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚
sentinel monitor mymaster 127.0.0.1 6379 1
```

![img](https://img-blog.csdnimg.cn/06d6391b367d46309376900f9962e3cc.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center)

## Redisé›†ç¾¤

::: warning é›†ç¾¤ä¹‹å‰é‡åˆ°çš„é—®é¢˜
1. å®¹é‡ä¸å¤Ÿï¼Œrediså¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ
2. å¹¶å‘å†™æ“ä½œï¼Œ rediså¦‚ä½•åˆ†æ‘Šï¼Ÿ
3. ä¸»ä»æ¨¡å¼ï¼Œè–ªç«ç›¸ä¼ æ¨¡å¼ï¼Œä¸»æœºå®•æœºï¼Œå¯¼è‡´ipåœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¸­é…ç½®éœ€è¦ä¿®æ”¹å¯¹åº”çš„ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ã€‚

redis3.0ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®ã€‚
:::

### é›†ç¾¤æ¦‚è¿°

- Redis é›†ç¾¤å®ç°äº†å¯¹Redisçš„æ°´å¹³æ‰©å®¹
- å³å¯åŠ¨Nä¸ªredisèŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™Nä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„1/Nã€‚

- Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰
- å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚
  
![img](https://img-blog.csdnimg.cn/a119e8e84725496b9cc8022f62f98260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NDA4Mzkw,size_16,color_FFFFFF,t_70#pic_center)

::: danger æ€»ç»“ï¼šRediséƒ¨ç½²çš„å››ç§æ¨¡å¼
1. å•æœºæ¨¡å¼ ğŸ’»
2. ä¸»ä»æ¨¡å¼ ğŸ’» - ğŸ’» - ğŸ’»
3. å“¨å…µæ¨¡å¼ ğŸª– - ?>> ğŸ’»
4. é›†ç¾¤æ¨¡å¼ ğŸ’»ğŸ’»ğŸ’»ğŸ’»ğŸ’»ğŸ’» !>> ğŸ’»
:::

[å…·ä½“å‘½ä»¤ç‚¹å‡»æŸ¥çœ‹ï¼Œæ²¡å¾€ä¸‹å†™äº†](https://blog.csdn.net/qq_45408390/article/details/119731094)